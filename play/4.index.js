(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{451:function(t,e,i){"use strict";i.r(e);var n=i(465),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);var a=i(543),r=i(30);var u=function(t){i(541)},l=Object(r.a)(o.a,a.a,a.b,!1,u,"data-v-6fbadb04",null);l.options.__file="demo\\webrtc\\index.vue",e.default=l.exports},465:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(542);e.default={components:{},data:function(){return{videoList:[{url:"webrtc://172.26.10.14/live/livestream"}]}},mounted:function(){},methods:{addVideo:function(){this.videoList.push({url:""})},play:function(t,e){new n.JSWebrtc.VideoElement(this.$refs["videoInfo"+e][0])}}}},541:function(t,e,i){"use strict";i.r(e)},542:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JSWebrtc=void 0;var n=s(i(62)),o=s(i(24));function s(t){return t&&t.__esModule?t:{default:t}}var a,r,u=e.JSWebrtc={Player:null,VideoElement:null,CreateVideoElements:function(){for(var t=document.querySelectorAll(".jswebrtc"),e=0;e<t.length;e++)new u.VideoElement(t[e])},FillQuery:function(t,e){if(e.user_query={},0!=t.length){t.indexOf("?")>=0&&(t=t.split("?")[1]);for(var i=t.split("&"),n=0;n<i.length;n++){var o=i[n].split("=");e[o[0]]=o[1],e.user_query[o[0]]=o[1]}e.domain&&(e.vhost=e.domain)}},ParseUrl:function(t){var e=document.createElement("a");e.href=t.replace("rtmp://","http://").replace("webrtc://","http://").replace("rtc://","http://");var i=e.hostname,n=e.pathname.substr(1,e.pathname.lastIndexOf("/")-1),o=e.pathname.substr(e.pathname.lastIndexOf("/")+1);if((n=n.replace("...vhost...","?vhost=")).indexOf("?")>=0){var s=n.substr(n.indexOf("?"));n=n.substr(0,n.indexOf("?")),s.indexOf("vhost=")>0&&(i=s.substr(s.indexOf("vhost=")+"vhost=".length)).indexOf("&")>0&&(i=i.substr(0,i.indexOf("&")))}if(e.hostname==i){/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/.test(e.hostname)&&(i="__defaultVhost__")}var a="rtmp";t.indexOf("://")>0&&(a=t.substr(0,t.indexOf("://")));var r=e.port;r||("http"===a?r=80:"https"===a?r=443:"rtmp"===a?r=1935:"webrtc"!==a&&"rtc"!==a||(r=1985));var l={url:t,schema:a,server:e.hostname,port:r,vhost:i,app:n,stream:o};return u.FillQuery(e.search,l),l},HttpPost:function(t,e){return new o.default((function(i,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&o.status>=200&&o.status<300){var t=JSON.parse(o.responseText);o.onreadystatechange=new Function,o=null,i(t)}},o.open("POST",t,!0),o.timeout=5e3,o.responseType="text",o.setRequestHeader("Content-Type","application/json"),o.send(e)}))}};"complete"===document.readyState?u.CreateVideoElements():document.addEventListener("DOMContentLoaded",u.CreateVideoElements),u.VideoElement=((a=function t(e){var i=e.dataset.url;if(!i)throw"VideoElement has no `data-url` attribute";var n=function(t,e){for(var i in e)t.style[i]=e[i]};this.container=e,n(this.container,{display:"inline-block",position:"relative",minWidth:"80px",minHeight:"80px"}),this.video=document.createElement("video"),this.video.width=960,this.video.height=540,n(this.video,{display:"block",width:"100%",height:"100%"}),this.container.appendChild(this.video),this.playButton=document.createElement("div"),this.playButton.innerHTML=t.PLAY_BUTTON,n(this.playButton,{zIndex:2,position:"absolute",top:"0",bottom:"0",left:"0",right:"0",maxWidth:"75px",maxHeight:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.playButton);var o={video:this.video};for(var s in e.dataset)try{o[s]=JSON.parse(e.dataset[s])}catch(t){o[s]=e.dataset[s]}if(this.player=new u.Player(i,o),e.playerInstance=this.player,o.poster&&!o.autoplay&&(o.decodeFirstFrame=!1,this.poster=new Image,this.poster.src=o.poster,this.poster.addEventListener("load",this.posterLoaded),n(this.poster,{display:"block",zIndex:1,position:"absolute",top:0,left:0,bottom:0,right:0}),this.container.appendChild(this.poster)),this.player.options.streaming||this.container.addEventListener("click",this.onClick.bind(this)),o.autoplay&&(this.playButton.style.display="none"),this.player.audioOut&&!this.player.audioOut.unlocked){var a=this.container;o.autoplay&&(this.unmuteButton=document.createElement("div"),this.unmuteButton.innerHTML=t.UNMUTE_BUTTON,n(this.unmuteButton,{zIndex:2,position:"absolute",bottom:"10px",right:"20px",width:"75px",height:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.unmuteButton),a=this.unmuteButton),this.unlockAudioBound=this.onUnlockAudio.bind(this,a),a.addEventListener("touchstart",this.unlockAudioBound,!1),a.addEventListener("click",this.unlockAudioBound,!0)}}).prototype.onUnlockAudio=function(t,e){this.unmuteButton&&(e.preventDefault(),e.stopPropagation()),this.player.audioOut.unlock(function(){this.unmuteButton&&(this.unmuteButton.style.display="none"),t.removeEventListener("touchstart",this.unlockAudioBound),t.removeEventListener("click",this.unlockAudioBound)}.bind(this))},a.prototype.onClick=function(t){this.player.isPlaying?(this.player.pause(),this.playButton.style.display="block"):(this.player.play(),this.playButton.style.display="none",this.poster&&(this.poster.style.display="none"))},a.PLAY_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 200 200" alt="Play video"><circle cx="100" cy="100" r="90" fill="none" stroke-width="15" stroke="#fff"/><polygon points="70, 55 70, 145 145, 100" fill="#fff"/></svg>',a.UNMUTE_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 75 75"><polygon class="audio-speaker" stroke="none" fill="#fff" points="39,13 22,28 6,28 6,47 21,47 39,62 39,13"/><g stroke="#fff" stroke-width="5"><path d="M 49,50 69,26"/><path d="M 69,50 49,26"/></g></svg>',a),u.Player=((r=function(t,e){if(this.options=e||{},!t.match(/^webrtc?:\/\//))throw"JSWebrtc just work with webrtc";if(!this.options.video)throw"VideoElement is null";this.urlParams=u.ParseUrl(t),this.pc=null,this.autoplay=!!e.autoplay||!1,this.paused=!0,this.autoplay&&(this.options.video.muted=!0),this.startLoading()}).prototype.startLoading=function(){var t=this;t.pc&&t.pc.close(),t.pc=new RTCPeerConnection(null),t.pc.ontrack=function(e){t.options.video.srcObject=e.streams[0]},t.pc.addTransceiver("audio",{direction:"recvonly"}),t.pc.addTransceiver("video",{direction:"recvonly"}),t.pc.createOffer().then((function(e){return t.pc.setLocalDescription(e).then((function(){return e}))})).then((function(e){return new o.default((function(i,o){var s=t.urlParams.port||1985,a=t.urlParams.user_query.play||"/rtc/v1/play/";a.lastIndexOf("/")!=a.length-1&&(a+="/");var r="http://"+t.urlParams.server+":"+s+a;for(var l in t.urlParams.user_query)"api"!=l&&"play"!=l&&(r+="&"+l+"="+t.urlParams.user_query[l]);var d={api:r,streamurl:t.urlParams.url,clientip:null,sdp:e.sdp};console.log("offer: "+(0,n.default)(d)),u.HttpPost(r,(0,n.default)(d)).then((function(t){console.log("answer: "+(0,n.default)(t)),i(t.sdp)}),(function(t){o(t)}))}))})).then((function(e){return t.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))})).catch((function(t){throw t})),this.autoplay&&this.play()},r.prototype.play=function(t){this.animationId||(this.animationId=requestAnimationFrame(this.update.bind(this)),this.paused=!1)},r.prototype.pause=function(t){this.paused||(cancelAnimationFrame(this.animationId),this.animationId=null,this.isPlaying=!1,this.paused=!0,this.options.video.pause(),this.options.onPause&&this.options.onPause(this))},r.prototype.stop=function(t){this.pause()},r.prototype.destroy=function(){this.pause(),this.pc&&this.pc.close()&&this.pc.destroy(),this.audioOut&&this.audioOut.destroy()},r.prototype.update=function(){this.animationId=requestAnimationFrame(this.update.bind(this)),this.options.video.readyState<4||this.isPlaying||(this.isPlaying=!0,this.options.video.play(),this.options.onPlay&&this.options.onPlay(this))},r)},543:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return o}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"100%",width:"100%"}},[i("el-button",{on:{click:t.addVideo}},[t._v("新增")]),t._v(" "),i("div",{staticClass:"video-list"},t._l(t.videoList,(function(e,n){return i("div",{key:n,staticClass:"video-box"},[i("div",{staticStyle:{display:"flex"}},[i("el-input",{model:{value:e.url,callback:function(i){t.$set(e,"url",i)},expression:"videoInfo.url"}}),t._v(" "),i("el-button",{on:{click:function(i){return t.play(e.url,n)}}},[t._v("播放")])],1),t._v(" "),i("div",{ref:"videoInfo"+n,refInFor:!0,staticClass:"jswebrtc",attrs:{"data-url":e.url,"data-autoplay":!0}})])})),0)],1)},o=[];n._withStripped=!0}}]);