(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{448:function(e,t,n){"use strict";n.r(t);var a=n(462),i=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);var o=n(535),r=n(30);var c=function(e){n(534)},d=Object(r.a)(i.a,o.a,o.b,!1,c,"data-v-eaaadb7a",null);d.options.__file="demo\\tools\\replay.vue",t.default=d.exports},462:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i,s=v(n(38)),o=v(n(39)),r=v(n(216)),c=n(64),d=n(46),l=(n(0),n(17)),u=v(n(471)),p=n(67);function v(e){return e&&e.__esModule?e:{default:e}}t.default={components:{MapView:r.default},data:function(){return{projectid:93151045894923,mapConfig:{compass:!0,control:!1,renderMode:"lod",lodUrl:"https://ace.apollo.auto/pdtmap/lod/guangzhou2/dec.json",lodStyle:d.style,mode:"SCEME_WITH_GLOW",style:{background:"gradient",aaMode:1}},config:{},link:"ws://10.12.75.239:8817/mapServer/track/specific/ws",timeServer:"http://10.12.205.143:8099/replay",message:'{"lng":113.44612891545145,"lat":23.168229692390668,"dis":1000,"TimeStamp":1629673200505}',eventId:null,eventTimes:[16316682e5,163166823e4],currentTime:null}},created:function(){this.showViewParams=[113.4653195,22.8437947,31503.6,0,-.6768649348971942,0],this.josn=u.default},beforeDestroy:function(){this.wsConnect.dispose()},mounted:function(){var e=l.Utils.transformWGS84ToUTM({x:113.54298823073374,y:23.32843438609696}),t=e.x,n=e.y;console.log("转化",t,n),this.playindex=0,this.testList=[],this.eventMap={61914278:"BDOF2006082G04",61914279:"BDOF2006032G05",61914280:"BDOF2006082G04"}},methods:{trafficInit:function(e){var t=this;this.view=this.$refs.view,this.map=this.view.$refs.map,this.Map=this.map.Map,this.view.betterRenderConfig={delayDisappear:!1,removeShake:!0,rectify:!1,insertData:!1},this.lodLayer=e,this.map.animationTo(this.showViewParams,1e3,!1),this.Map.viewer.addEventListener("camera_changed",(function(){var e=t.Map.viewer.getCameraPosition(!0),n=e.x,a=e.y,i=(e.z,e.yaw,t.Map.transformUTMToWGS84({x:n,y:a}));t.position=i}));(0,p.getRscuList)({pageSize:1e3}).then((function(e){e.data.list.forEach((function(e){var n=e.sn,a=e.roadId,i=e.longitude,s=e.latitude,o=e.roadDesc;t.roadSnMap[n]={roadId:a,roadDesc:o,position:[i,s]}}))})),this.view.loadModels({path:"https://mapdata.bj.bcebos.com/model/guangzhou/",names:[],animateNames:[],commonPath:"https://mapdata.bj.bcebos.com/model/common/",commonNames:["trafficLights","robobus","robocop","robotaxi","netCar","car","bus","truck","sanlunche","pedestrian","diandongche","bicycle","traffic_cone","salecar","cleanCar","wxb","dumpTruck","minibus","newbus","newcar","pedestrian_man_animate","pedestrian_woman_animate","newtricycle","trafficcone","newmotorcycle","newtruck","newbicycle"]}).then((function(){t.view.setSideLayer().then((function(e){console.log("sideList",e)})),t.view.addRegion({cityRange:"merged_src_region.geojson",townshipRange:"merged_src_黄浦区.geojson"}).then((function(e){console.log(e)})),t.view.setRootView([113.4653195,22.8437947,31503.6,0,-.6768649348971942,0]),t.replayPlayer=t.view.getReplayConnect("180.76.36.65:19001",!0)}))},connect:(i=(0,o.default)(s.default.mark((function e(){var t,n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new c.Ws({needToken:!1}),e.next=3,t.connect(this.link);case 3:n=e.sent,this.wsConnect=n,this.view.handleMixData({ws:t,connect:n},2e3,{z:1});case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)}),replay:(a=(0,o.default)(s.default.mark((function e(){var t,n=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.eventId){e.next=2;break}return e.abrupt("return");case 2:t=this.view.roadSnMap[this.eventMap[this.eventId]].roadId,this.view.goToSide(t),this.view.sendMixParams({eventID:this.eventId},"replayWs"),setTimeout((function(){n.replayPlayer.clear(),n.currentTime=null}),3e4);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)}),getReplayData:function(e){var t=e[0].timestamp;this.currentTime=t},back:function(){this.view.resetNormal(),this.replayWsContract.dispose(),this.replayPlayer.clear(),this.currentTime=null,this.replayPlayer=this.view.getReplayConnect("180.76.36.65:19001",!0)},stop:function(){}}}},534:function(e,t,n){"use strict";n.r(t)},535:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"map-view",staticStyle:{height:"100%",display:"flex"}},[n("map-view",{ref:"view",attrs:{id:"1","city-id":"guangzhou","map-config":e.mapConfig,config:e.config,mix:!0,"project-id":e.projectid},on:{trafficInit:e.trafficInit,pushReplayData:e.getReplayData}}),e._v(" "),n("div",{staticClass:"btn-box"},[n("div",{staticClass:"btn"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.eventId,expression:"eventId"}],attrs:{type:"text"},domProps:{value:e.eventId},on:{input:function(t){t.target.composing||(e.eventId=t.target.value)}}}),e._v(" "),n("div",{staticClass:"btn",on:{click:e.replay}},[e._v("回放")]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.currentTime,expression:"currentTime"}],staticClass:"replay-info"},[n("div",[e._v("开始时间 "+e._s(e.eventTimes[0]))]),e._v(" "),n("div",[e._v("结束时间 "+e._s(e.eventTimes[1]))]),e._v(" "),n("div",[e._v("当前时间 "+e._s(e.currentTime))])]),e._v(" "),n("div",{staticClass:"btn",on:{click:e.back}})])])],1)},i=[];a._withStripped=!0}}]);